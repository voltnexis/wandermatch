(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{552:function(e,t,i){Promise.resolve().then(i.bind(i,1265)),Promise.resolve().then(i.t.bind(i,9282,23)),Promise.resolve().then(i.t.bind(i,2290,23)),Promise.resolve().then(i.t.bind(i,7960,23))},1265:function(e,t,i){"use strict";i.d(t,{a:function(){return s},default:function(){return l}});var r=i(7437),n=i(2265),o=i(2141);let a=(0,n.createContext)({user:null,loading:!0,signOut:async()=>{},setUser:()=>{},signUp:async()=>({error:"Not implemented"}),signIn:async()=>({error:"Not implemented"})}),s=()=>{let e=(0,n.useContext)(a);if(!e)throw Error("useAuth must be used within AuthProvider");return e};function l(e){let{children:t}=e,[i,s]=(0,n.useState)(null),[l,c]=(0,n.useState)(!0);(0,n.useEffect)(()=>{(async()=>{let{data:{session:e}}=await o.OQ.auth.getSession();if(null==e?void 0:e.user){let{data:t}=await o.OQ.from("users").select("*").eq("id",e.user.id).single();t&&(await (0,o.yA)(t.id,!0),s({...t,is_online:!0}))}c(!1)})();let{data:{subscription:e}}=o.OQ.auth.onAuthStateChange(async(e,t)=>{if(null==t?void 0:t.user){let{data:e}=await o.OQ.from("users").select("*").eq("id",t.user.id).single();e&&(await (0,o.yA)(e.id,!0),s({...e,is_online:!0}))}else s(null);c(!1)});return()=>e.unsubscribe()},[]);let u=async()=>{i&&await (0,o.yA)(i.id,!1),await o.OQ.auth.signOut(),s(null)},f=async(e,t,i)=>{try{let{data:r,error:n}=await o.OQ.auth.signUp({email:e,password:t,options:{data:i,emailRedirectTo:void 0}});if(n)return console.error("Signup error:",n),{error:n.message};return console.log("Signup successful:",r),{error:void 0}}catch(e){return console.error("Signup exception:",e),{error:"Signup failed"}}},d=async(e,t)=>{try{let{data:i,error:r}=await o.OQ.auth.signInWithPassword({email:e,password:t});if(r)return{error:r.message};return{error:void 0}}catch(e){return{error:"Login failed"}}};return(0,r.jsx)(a.Provider,{value:{user:i,loading:l,signOut:u,setUser:s,signUp:f,signIn:d},children:t})}},2141:function(e,t,i){"use strict";i.d(t,{AJ:function(){return h},AW:function(){return _},Bp:function(){return v},DJ:function(){return b},EF:function(){return y},ET:function(){return g},F6:function(){return m},GA:function(){return L},Jq:function(){return j},Lj:function(){return f},OQ:function(){return a},P_:function(){return w},SH:function(){return c},X_:function(){return R},_p:function(){return d},b6:function(){return O},bE:function(){return E},createChatRoom:function(){return S},dZ:function(){return s},di:function(){return P},ez:function(){return u},ip:function(){return q},isMutualLike:function(){return U},lR:function(){return A},nX:function(){return p},oB:function(){return k},qb:function(){return N},ww:function(){return J},xT:function(){return l},yA:function(){return C},zp:function(){return D}});var r=i(8439);let n="https://rbhdvffmsgjhorzubghj.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJiaGR2ZmZtc2dqaG9yenViZ2hqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2NDI2NDcsImV4cCI6MjA3MjIxODY0N30.y_8P2L6esbjRfRc7LcfphLSL9GEMh5Vw_mlY0EePBpg";if(!n||!o)throw Error("Missing Supabase environment variables. Please check your .env.local file.");if(n.includes("your_supabase_project_url_here"))throw Error("Please update your Supabase URL in .env.local with your actual project URL");let a=(0,r.eI)(n,o),s=async e=>{let t=a.from("kerala_locations").select("*").order("is_featured",{ascending:!1});(null==e?void 0:e.type)&&"all"!==e.type&&(t=t.eq("type",e.type)),(null==e?void 0:e.district)&&"all"!==e.district&&(t=t.eq("district",e.district));let{data:i,error:r}=await t;if(r)throw r;return i},l=async e=>{let{data:t,error:i}=await a.from("travel_plans").select("*").eq("user_id",e).eq("is_active",!0);if(i)throw i;return t},c=async e=>{let{data:t,error:i}=await a.from("travel_plans").insert([e]).select().single();if(i)throw i;return t};async function u(e,t,i){let r={user_id:e,destination:t,district:i,start_date:new Date().toISOString().split("T")[0],end_date:new Date(Date.now()+6048e5).toISOString().split("T")[0],travel_type:"leisure",description:"Visit ".concat(t),is_active:!0};return await c(r)}async function f(e,t){let{interests:i,...r}=t,{data:n,error:o}=await a.from("users").update(r).eq("id",e).select().single();if(o)throw o;return n}async function d(e,t){if(t.size>5242880)throw Error("File size must be less than 5MB");if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(t.type))throw Error("Only JPEG, PNG, and WebP images are allowed");let i=t.name.split(".").pop(),r="".concat(e,"-").concat(Date.now(),".").concat(i),n="profile-images/".concat(r),{error:o}=await a.storage.from("profile-images").upload(n,t);if(o)throw o;let{data:s}=a.storage.from("profile-images").getPublicUrl(n);return s.publicUrl}async function _(){let{data:e,error:t}=await a.from("users").select("*").order("created_at",{ascending:!1});if(t)throw t;return e}async function w(e,t){let{data:i,error:r}=await a.from("user_follows").insert([{follower_id:e,following_id:t}]).select().single();if(r)throw r;return i}async function m(e,t){let{error:i}=await a.from("user_follows").delete().eq("follower_id",e).eq("following_id",t);if(i)throw i}async function p(e){let{data:t,error:i}=await a.from("user_follows").select("\n      following_id,\n      following:users!user_follows_following_id_fkey(*)\n    ").eq("follower_id",e);if(i)throw i;return t.map(e=>({...e.following,is_online:e.following.is_online||!1}))}async function g(e){let{data:t,error:i}=await a.from("user_follows").select("\n      follower_id,\n      follower:users!user_follows_follower_id_fkey(*)\n    ").eq("following_id",e);if(i)throw i;return t.map(e=>e.follower)}async function h(e,t){let{data:i,error:r}=await a.from("user_follows").select("id").eq("follower_id",e).eq("following_id",t).single();if(r&&"PGRST116"!==r.code)throw r;return!!i}async function y(e,t){let{data:i,error:r}=await a.from("user_likes").insert([{liker_id:e,liked_id:t}]).select().single();if(r)throw r;try{let{data:i,error:r}=await a.from("user_likes").select("id").eq("liker_id",t).eq("liked_id",e).single();if(i&&!r){await I(e,t);let i=await S(e,t,!0);console.log("Romantic chat room created:",i)}}catch(e){console.error("Error checking mutual like:",e)}return i}async function k(e,t){let{error:i}=await a.from("user_likes").delete().eq("liker_id",e).eq("liked_id",t);if(i)throw i;await a.from("matches").delete().or("and(user1_id.eq.".concat(e,",user2_id.eq.").concat(t,"),and(user1_id.eq.").concat(t,",user2_id.eq.").concat(e,")"))}async function q(e,t){let{data:i,error:r}=await a.from("user_likes").select("id").eq("liker_id",e).eq("liked_id",t).single();if(r&&"PGRST116"!==r.code)throw r;return!!i}async function b(e){let{data:t,error:i}=await a.from("user_likes").select("\n      liked_id,\n      liked:users!user_likes_liked_id_fkey(*)\n    ").eq("liker_id",e);if(i)throw i;return t.map(e=>e.liked)}async function v(e){let{data:t,error:i}=await a.from("user_likes").select("\n      liker_id,\n      liker:users!user_likes_liker_id_fkey(*)\n    ").eq("liked_id",e);if(i)throw i;return t.map(e=>e.liker)}async function I(e,t){let{data:i,error:r}=await a.from("matches").insert([{user1_id:e,user2_id:t}]).select().single();if(r)throw r;return i}async function S(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{data:r}=await a.from("chat_rooms").select("*").or("and(participant1_id.eq.".concat(e,",participant2_id.eq.").concat(t,"),and(participant1_id.eq.").concat(t,",participant2_id.eq.").concat(e,")")).single();if(r){if(i&&!r.is_romantic){let{data:e,error:t}=await a.from("chat_rooms").update({is_romantic:!0}).eq("id",r.id).select().single();if(t)throw t;return e}return r}let{data:n,error:o}=await a.from("chat_rooms").insert([{participant1_id:e,participant2_id:t,is_romantic:i}]).select("\n      *,\n      participant1:users!chat_rooms_participant1_id_fkey(*),\n      participant2:users!chat_rooms_participant2_id_fkey(*)\n    ").single();if(o)throw o;return n}async function P(e){let{data:t,error:i}=await a.from("chat_rooms").select("\n      *,\n      participant1:users!chat_rooms_participant1_id_fkey(*),\n      participant2:users!chat_rooms_participant2_id_fkey(*)\n    ").or("participant1_id.eq.".concat(e,",participant2_id.eq.").concat(e)).order("last_message_time",{ascending:!1});if(i)throw i;return t}async function O(e){let{data:t,error:i}=await a.from("chat_messages").select("\n      *,\n      sender:users!chat_messages_sender_id_fkey(*)\n    ").eq("room_id",e).order("created_at",{ascending:!0});if(i)throw i;return t}async function E(e,t,i){let{data:r,error:n}=await a.from("chat_messages").insert([{room_id:e,sender_id:t,content:i}]).select().single();if(n)throw n;return await a.from("chat_rooms").update({last_message:i,last_message_time:new Date().toISOString()}).eq("id",e),r}async function N(e,t,i,r){let n=null;if(r){let t=r.name.split(".").pop(),i="".concat(e,"-").concat(Date.now(),".").concat(t),o="post-images/".concat(i),{error:s}=await a.storage.from("post-images").upload(o,r);if(s)throw s;let{data:l}=a.storage.from("post-images").getPublicUrl(o);n=l.publicUrl}let{data:o,error:s}=await a.from("posts").insert([{user_id:e,content:t,location_tag:i,image_url:n}]).select().single();if(s)throw s;return o}async function j(){let{data:e,error:t}=await a.from("posts").select("\n      *,\n      user:users!posts_user_id_fkey(*)\n    ").order("created_at",{ascending:!1});if(t)throw t;return e}async function J(e){let{data:t,error:i}=await a.from("posts").select("*").eq("user_id",e).order("created_at",{ascending:!1});if(i)throw i;return t}async function R(e){var t,i;let[r,n]=await Promise.all([a.from("user_follows").select("id").eq("following_id",e),a.from("user_follows").select("id").eq("follower_id",e)]);return{followers:(null===(t=r.data)||void 0===t?void 0:t.length)||0,following:(null===(i=n.data)||void 0===i?void 0:i.length)||0,likes:0}}async function A(e,t,i){let{data:r,error:n}=await a.from("location_ratings").upsert([{user_id:e,location_name:t,rating:i}]).select().single();if(n)throw n;return r}async function D(e){let{data:t,error:i}=await a.from("location_ratings").select("rating").eq("location_name",e);if(i)throw i;if(!t||0===t.length)return{average:0,count:0};let r=t.map(e=>e.rating);return{average:Math.round(r.reduce((e,t)=>e+t,0)/r.length*10)/10,count:r.length}}async function C(e,t){let{error:i}=await a.from("users").update({is_online:t,last_seen:new Date().toISOString()}).eq("id",e);if(i)throw i}async function L(e){let{data:t,error:i}=await a.from("users").select("*").eq("id",e).single();if(i)throw i;return t}async function U(e,t){let[i,r]=await Promise.all([a.from("user_likes").select("id").eq("liker_id",e).eq("liked_id",t).single(),a.from("user_likes").select("id").eq("liker_id",t).eq("liked_id",e).single()]);return!!(i.data&&r.data)}},7960:function(){},9282:function(e){e.exports={style:{fontFamily:"'__Inter_e8ce0c', '__Inter_Fallback_e8ce0c'",fontStyle:"normal"},className:"__className_e8ce0c",variable:"__variable_e8ce0c"}},2290:function(e){e.exports={style:{fontFamily:"'__Poppins_6bee3b', '__Poppins_Fallback_6bee3b'",fontStyle:"normal"},className:"__className_6bee3b",variable:"__variable_6bee3b"}}},function(e){e.O(0,[369,439,971,117,744],function(){return e(e.s=552)}),_N_E=e.O()}]);